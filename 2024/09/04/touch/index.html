<!DOCTYPE html>
<html lang="zh">
  <head>
    
    <meta charset="UTF-8">
    <title>touch - 我勒博客</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta property="og:site_name" content="我勒博客">
    <meta property="og:title" content="touch"/>
    
    <style>body:before{ content: ''; background-image: url(https://api.paugram.com/wallpaper?source=sm) }</style>
    
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="我勒博客" type="application/atom+xml">
</head>

  <body>
    <header>
    <div class="head-title">
        <h4>我勒博客</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a href>分类</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/Hexo/">Hexo</a><a class="category-link" href="/categories/unity/">unity</a><a class="category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="page-title">
            <h2>touch</h2>
        </section>
        <article class="page-content">
        
            <blockquote>这篇文章上次修改于 212 天前，可能其部分内容已经发生变化，如有疑问可询问作者。</blockquote>
        
            <p>问题:在Unity点击事件中如何检测手势呢? 如何在不同平台互通呢？<br>实现统一的手势检测脚本是必要的，总不能每次使用的时候都写一遍</p>
<p>1.方法一 是可以通过继承 IPointerDownHandler，IPointerUpHandler，IDragHandler等接口监听对应的事件，在判断是否达成对应的手势<br>这样实现的逻辑在多平台都是可行的 window的鼠标点击 和移动平台的Touc都会响应接口</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIFingerTrigger</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    , <span class="title">IPointerDownHandler</span></span><br><span class="line">    , <span class="title">IPointerUpHandler</span></span><br><span class="line">    , <span class="title">IDragHandler</span></span><br><span class="line">    , <span class="title">IBeginDragHandler</span></span><br><span class="line">    , <span class="title">IEndDragHandler</span></span><br><span class="line">    , <span class="title">IScrollHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Action&lt;<span class="built_in">float</span>&gt; OnPinch;  <span class="comment">//双指放大 缩小</span></span><br><span class="line">    <span class="keyword">public</span> Action&lt;Vector2&gt; OnDrag; <span class="comment">//拖拽</span></span><br><span class="line">    <span class="keyword">public</span> Action OnDragEnd;        <span class="comment">//拖拽结束</span></span><br><span class="line">    <span class="keyword">public</span> Action&lt;Vector2&gt; OnClick;  <span class="comment">//点击</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> IBeginDragHandler.OnBeginDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> IDragHandler.OnDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> IEndDragHandler.OnEndDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> IPointerDownHandler.OnPointerDown(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> IPointerUpHandler.OnPointerUp(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> IScrollHandler.OnScroll(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实现一下具体的手释功能 这里可以定制化 实现特殊需求 这里只展示一下这里的手势逻辑</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIFingerTrigger</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">        , <span class="title">IPointerDownHandler</span></span><br><span class="line">        , <span class="title">IPointerUpHandler</span></span><br><span class="line">        , <span class="title">IDragHandler</span></span><br><span class="line">        , <span class="title">IBeginDragHandler</span></span><br><span class="line">        , <span class="title">IEndDragHandler</span></span><br><span class="line">        , <span class="title">IScrollHandler</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Action&lt;<span class="built_in">float</span>&gt; OnPinch;</span><br><span class="line">        <span class="keyword">public</span> Action&lt;Vector2&gt; OnDrag;</span><br><span class="line">        <span class="keyword">public</span> Action OnDragEnd;</span><br><span class="line">        <span class="keyword">public</span> Action&lt;Vector2&gt; OnClick;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">class</span> <span class="title">PointData</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> _pointId; <span class="comment">//点 id</span></span><br><span class="line">            <span class="keyword">public</span> Vector2 _pointPosition; <span class="comment">//点 位置</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">bool</span> _down; <span class="comment">//是否按下</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">private</span> List&lt;PointData&gt; _pointData = <span class="keyword">new</span> List&lt;PointData&gt;() <span class="comment">//最多2指操作</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> PointData(),</span><br><span class="line">            <span class="keyword">new</span> PointData(),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> _pointDistance; <span class="comment">//双点距离</span></span><br><span class="line">        <span class="comment">//拖拽状态</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> _drag = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//双指操作</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> _pinch = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">private</span> PointerEventData _pointerDragData;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">int</span> <span class="title">GetPointCount</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> point <span class="keyword">in</span> _pointData)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (point._down)</span><br><span class="line">                &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddPoint</span>(<span class="params">PointerEventData pointData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> index = <span class="number">0</span>; index &lt; <span class="number">2</span>; index++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_pointData[index]._down)</span><br><span class="line">                &#123;</span><br><span class="line">                    _pointData[index]._pointId = pointData.pointerId;</span><br><span class="line">                    _pointData[index]._pointPosition = pointData.position;</span><br><span class="line">                    _pointData[index]._down = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RemovePoint</span>(<span class="params">PointerEventData pointData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            PointData removePoint = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> point <span class="keyword">in</span> _pointData)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (point._pointId == pointData.pointerId)</span><br><span class="line">                &#123;</span><br><span class="line">                    point._down = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdatePoint</span>(<span class="params">PointerEventData pointData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> point <span class="keyword">in</span> _pointData)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (point._pointId == pointData.pointerId)</span><br><span class="line">                &#123;</span><br><span class="line">                    point._pointPosition = pointData.position;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IBeginDragHandler.OnBeginDrag(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (GetPointCount() == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _drag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (GetPointCount() == <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _drag = <span class="literal">true</span>; <span class="comment">// 双手的时候 算 但是也在拖拽 为了屏蔽 双手释放的</span></span><br><span class="line">                _pinch = <span class="literal">true</span>;</span><br><span class="line">                _pointDistance = Vector2.Distance(_pointData[<span class="number">0</span>]._pointPosition, _pointData[<span class="number">1</span>]._pointPosition);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IDragHandler.OnDrag(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            _pointerDragData = eventData;</span><br><span class="line">            UpdatePoint(eventData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IEndDragHandler.OnEndDrag(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_pinch)</span><br><span class="line">            &#123;</span><br><span class="line">                _pinch = <span class="literal">false</span>;</span><br><span class="line">                OnPinch?.Invoke(<span class="number">0f</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_drag)</span><br><span class="line">            &#123;</span><br><span class="line">                _drag = <span class="literal">false</span>;</span><br><span class="line">                OnDragEnd?.Invoke();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IPointerDownHandler.OnPointerDown(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (GetPointCount() &lt; <span class="number">2</span>) <span class="comment">//只考虑 2个手指</span></span><br><span class="line">            &#123;</span><br><span class="line">                AddPoint(eventData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IPointerUpHandler.OnPointerUp(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!_drag &amp;&amp; !_pinch &amp;&amp; GetPointCount() == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                OnClick?.Invoke(eventData.position);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            RemovePoint(eventData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !UNITY_EDITOR</span></span><br><span class="line">            <span class="keyword">if</span> (Input.touchCount == <span class="number">0</span>) <span class="comment">//容错</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> point <span class="keyword">in</span> _pointData)</span><br><span class="line">                &#123;</span><br><span class="line">                    point._down = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">            <span class="keyword">if</span> (_pointerDragData == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_pinch)</span><br><span class="line">                &#123;</span><br><span class="line">                    OnPinch?.Invoke(<span class="number">0f</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (_drag)</span><br><span class="line">                &#123;</span><br><span class="line">                    OnDrag?.Invoke(Vector2.zero);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_pinch)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">float</span> distance = Vector2.Distance(_pointData[<span class="number">0</span>]._pointPosition, _pointData[<span class="number">1</span>]._pointPosition);</span><br><span class="line">                <span class="built_in">float</span> opDistance = _pointDistance - distance;</span><br><span class="line">                <span class="keyword">if</span> (Mathf.Abs(opDistance) &gt; <span class="number">0.8f</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    OnPinch?.Invoke(opDistance);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    OnPinch?.Invoke(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                _pointDistance = distance;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_drag)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_pointerDragData.pointerId == _pointData[<span class="number">0</span>]._pointId)</span><br><span class="line">                &#123;</span><br><span class="line">                    OnDrag?.Invoke(_pointerDragData.delta);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _pointerDragData = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IScrollHandler.OnScroll(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            OnPinch?.Invoke(eventData.scrollDelta.y * <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>缺点 上面的代码可以实现效果 但是因为脚本是继承MonoBehaviour的 对应检测的范围是MonoBehaviour所在UI物体的大小</p>
<p>2.方法二：不依赖接口的实现 通过使用Input类监听 这里移动平台使用Input.GetTouch来收集手指,pc平台使用Input.GetMouseButton<br>收集到手指处理对应的手势逻辑即可</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Finger</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Touch</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>] [Head(<span class="string">&quot;移动多少像素才算拖拽&quot;</span>)] <span class="keyword">private</span> <span class="built_in">int</span> _threshold = <span class="number">100</span>; <span class="comment">//移动多少才算拖拽</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] [Head(<span class="string">&quot;按多长时间算点击&quot;</span>)] <span class="keyword">private</span> <span class="built_in">float</span> _tapThreshold = <span class="number">0.2f</span>; <span class="comment">//按多长时间算点击</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] [Head(<span class="string">&quot;是否多手指&quot;</span>)] <span class="keyword">public</span> <span class="built_in">bool</span> _stopMulEvent; <span class="comment">//屏蔽多手指</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _stop; <span class="comment">//是否停止触控</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Finger&gt; _sFingers = <span class="keyword">new</span> List&lt;Finger&gt;(<span class="number">10</span>);</span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;快速点击&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnTap; <span class="comment">//快速点击回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;移动中&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnMove; <span class="comment">//移动中回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;长按抬起 拖拽抬起&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnSwipe; <span class="comment">//长按抬起回调 或者 拖拽抬起回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;抬起&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnUp; <span class="comment">//抬起回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;缩放&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;<span class="built_in">float</span>&gt; OnPinch; <span class="comment">//缩放回调</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stop)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        CollectFinger();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CollectFinger</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Input.touchCount &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> index = <span class="number">0</span>; index &lt;= Input.touchCount - <span class="number">1</span>; index++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> touch = Input.GetTouch(index);</span><br><span class="line">                <span class="keyword">if</span> (touch.phase == TouchPhase.Began || touch.phase == TouchPhase.Stationary ||</span><br><span class="line">                    touch.phase == TouchPhase.Moved)</span><br><span class="line">                &#123;</span><br><span class="line">                    AddFinger(index, touch.position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Input.GetMouseButton(<span class="number">0</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> screen = <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, Screen.width, Screen.height);</span><br><span class="line">                <span class="keyword">var</span> mousePos = Input.mousePosition;</span><br><span class="line">                Vector2 mp = <span class="keyword">new</span> Vector2(mousePos.x, mousePos.y);</span><br><span class="line">                <span class="keyword">if</span> (screen.Contains(mp))</span><br><span class="line">                &#123;</span><br><span class="line">                    AddFinger(<span class="number">-1</span>, mp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>下面，展示一下这里的手势实现，可自行实现定制化的手势。<br>这种方法通过 _set,_lastSet在不同状态下的值来确定手指的状态 很巧妙如下<br>(set lastSet)  true false 按下  — &gt; true true 持续按下 —– &gt; true true …. —– &gt; false true 抬起</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Finger</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> _set; <span class="comment">//状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> _lastSet; <span class="comment">//状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> _tap; <span class="comment">//点击</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> _swipe; <span class="comment">//长按抬起 或者 拖动抬起</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> _move; <span class="comment">//是否移动中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> _dragging; <span class="comment">//是否推拽</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> _index; <span class="comment">//手指索引</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> _age; <span class="comment">//手指持续时间</span></span><br><span class="line">    <span class="keyword">public</span> Vector2 _startScreenPos; <span class="comment">//手指开始触屏位置</span></span><br><span class="line">    <span class="keyword">public</span> Vector2 _lastScreenPos; <span class="comment">//上一帧手指位置</span></span><br><span class="line">    <span class="keyword">public</span> Vector2 _screenPos; <span class="comment">//更新中的位置</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsUp</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> !_set &amp;&amp; _lastSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector2 <span class="title">GetSwipeScreenDelta</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _screenPos - _startScreenPos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsDown</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _set &amp;&amp; !_lastSet;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Touch</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>] [Head(<span class="string">&quot;移动多少像素才算拖拽&quot;</span>)] <span class="keyword">private</span> <span class="built_in">int</span> _threshold = <span class="number">100</span>; <span class="comment">//移动多少才算拖拽</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] [Head(<span class="string">&quot;按多长时间算点击&quot;</span>)] <span class="keyword">private</span> <span class="built_in">float</span> _tapThreshold = <span class="number">0.2f</span>; <span class="comment">//按多长时间算点击</span></span><br><span class="line">    [<span class="meta">SerializeField</span>] [Head(<span class="string">&quot;是否多手指&quot;</span>)] <span class="keyword">public</span> <span class="built_in">bool</span> _stopMulEvent; <span class="comment">//屏蔽多手指</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _stop; <span class="comment">//是否停止触控</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Finger&gt; _sFingers = <span class="keyword">new</span> List&lt;Finger&gt;(<span class="number">10</span>);</span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;快速点击&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnTap; <span class="comment">//快速点击回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;移动中&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnMove; <span class="comment">//移动中回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;长按抬起 拖拽抬起&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnSwipe; <span class="comment">//长按抬起回调 或者 拖拽抬起回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;抬起&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;Finger&gt; OnUp; <span class="comment">//抬起回调</span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;缩放&quot;</span>)</span>] <span class="keyword">public</span> UnityEvent&lt;<span class="built_in">float</span>&gt; OnPinch; <span class="comment">//缩放回调</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stop)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//单手指</span></span><br><span class="line">        BeginFinger();</span><br><span class="line">        CollectFinger();</span><br><span class="line">        EndFinger();</span><br><span class="line">        UpdateEvents();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//多手指缩放</span></span><br><span class="line">        UpdateMulFinger();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDestroy</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Stop();</span><br><span class="line">        OnTap = <span class="literal">null</span>;</span><br><span class="line">        OnPinch = <span class="literal">null</span>;</span><br><span class="line">        OnSwipe = <span class="literal">null</span>;</span><br><span class="line">        OnMove = <span class="literal">null</span>;</span><br><span class="line">        OnUp = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Finger <span class="title">FindFinger</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> finger <span class="keyword">in</span> _sFingers)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (finger._index == index)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> finger;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BeginFinger</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> index = _sFingers.Count - <span class="number">1</span>; index &gt;= <span class="number">0</span>; index--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> finger = _sFingers[index];</span><br><span class="line">            <span class="keyword">if</span> (finger.IsUp())</span><br><span class="line">            &#123;</span><br><span class="line">                _sFingers.RemoveAt(index);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                finger._lastSet = finger._set;</span><br><span class="line">                finger._lastScreenPos = finger._screenPos;</span><br><span class="line">                finger._set = <span class="literal">false</span>;</span><br><span class="line">                finger._tap = <span class="literal">false</span>;</span><br><span class="line">                finger._swipe = <span class="literal">false</span>;</span><br><span class="line">                finger._move = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CollectFinger</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Input.touchCount &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> index = <span class="number">0</span>; index &lt;= Input.touchCount - <span class="number">1</span>; index++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> touch = Input.GetTouch(index);</span><br><span class="line">                <span class="keyword">if</span> (touch.phase == TouchPhase.Began || touch.phase == TouchPhase.Stationary ||</span><br><span class="line">                    touch.phase == TouchPhase.Moved)</span><br><span class="line">                &#123;</span><br><span class="line">                    AddFinger(index, touch.position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Input.GetMouseButton(<span class="number">0</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> screen = <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, Screen.width, Screen.height);</span><br><span class="line">                <span class="keyword">var</span> mousePos = Input.mousePosition;</span><br><span class="line">                Vector2 mp = <span class="keyword">new</span> Vector2(mousePos.x, mousePos.y);</span><br><span class="line">                <span class="keyword">if</span> (screen.Contains(mp))</span><br><span class="line">                &#123;</span><br><span class="line">                    AddFinger(<span class="number">-1</span>, mp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddFinger</span>(<span class="params"><span class="built_in">int</span> index, Vector2 position</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> finger = FindFinger(index);</span><br><span class="line">        <span class="keyword">if</span> (finger == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            finger = <span class="keyword">new</span> Finger()</span><br><span class="line">            &#123;</span><br><span class="line">                _index = index,</span><br><span class="line">                _startScreenPos = position,</span><br><span class="line">                _lastScreenPos = position,</span><br><span class="line">                _lastSet = <span class="literal">false</span>,</span><br><span class="line">                _age = <span class="number">0</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">            _sFingers.Add(finger);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        finger._set = <span class="literal">true</span>;</span><br><span class="line">        finger._screenPos = position;</span><br><span class="line">        <span class="keyword">if</span> (!finger._dragging)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> sqrMagnitude = finger.GetSwipeScreenDelta().sqrMagnitude;</span><br><span class="line">            <span class="keyword">if</span> (sqrMagnitude &gt;= _threshold)</span><br><span class="line">            &#123;</span><br><span class="line">                finger._dragging = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EndFinger</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> index = _sFingers.Count - <span class="number">1</span>; index &gt;= <span class="number">0</span>; index--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> finger = _sFingers[index];</span><br><span class="line">            <span class="keyword">if</span> (finger.IsUp())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (finger._age &lt;= _tapThreshold &amp;&amp; finger._age &gt;= <span class="number">0</span> &amp;&amp; !finger._dragging)</span><br><span class="line">                &#123;</span><br><span class="line">                    finger._tap = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    finger._swipe = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!finger.IsDown())</span><br><span class="line">            &#123;</span><br><span class="line">                finger._move = <span class="literal">true</span>;</span><br><span class="line">                finger._age += +Time.unscaledDeltaTime;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateEvents</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_sFingers.Count == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            TriggerEvent();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!_stopMulEvent)</span><br><span class="line">            &#123;</span><br><span class="line">                TriggerEvent();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">TriggerEvent</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> finger <span class="keyword">in</span> _sFingers)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (finger.IsUp())</span><br><span class="line">                OnUp?.Invoke(finger);</span><br><span class="line">            <span class="keyword">if</span> (finger._tap)</span><br><span class="line">                OnTap?.Invoke(finger);</span><br><span class="line">            <span class="keyword">if</span> (finger._swipe)</span><br><span class="line">                OnSwipe?.Invoke(finger);</span><br><span class="line">            <span class="keyword">if</span> (finger._move)</span><br><span class="line">                OnMove?.Invoke(finger);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateMulFinger</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stopMulEvent)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (_sFingers.Count &gt;= <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//计算所有手指中心点</span></span><br><span class="line">            Vector2 curCenterPos = Vector2.zero;</span><br><span class="line">            Vector2 lastCenterPos = Vector2.zero;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> finger <span class="keyword">in</span> _sFingers)</span><br><span class="line">            &#123;</span><br><span class="line">                curCenterPos += finger._screenPos;</span><br><span class="line">                lastCenterPos += finger._lastScreenPos;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> fingerCount = _sFingers.Count;</span><br><span class="line">            curCenterPos /= fingerCount;</span><br><span class="line">            lastCenterPos /= fingerCount;</span><br><span class="line">            <span class="comment">//计算所有手指到中心点的距离</span></span><br><span class="line">            <span class="built_in">float</span> curDistance = <span class="number">0</span>, lastDistance = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> finger <span class="keyword">in</span> _sFingers)</span><br><span class="line">            &#123;</span><br><span class="line">                curDistance += Vector2.Distance(curCenterPos, finger._screenPos);</span><br><span class="line">                lastDistance += Vector2.Distance(lastCenterPos, finger._lastScreenPos);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            curDistance /= fingerCount;</span><br><span class="line">            lastDistance /= fingerCount;</span><br><span class="line">            <span class="keyword">if</span> (lastDistance &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> scale = curDistance / lastDistance;</span><br><span class="line">                <span class="keyword">if</span> (scale &gt; <span class="number">0</span> &amp;&amp; scale &lt; <span class="number">2</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    OnPinch?.Invoke(scale - <span class="number">1.0f</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> scroll = Input.mouseScrollDelta.y;</span><br><span class="line">        <span class="keyword">if</span> (scroll != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            scroll /= <span class="number">10</span>;</span><br><span class="line">            OnPinch?.Invoke(scroll);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//public</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stop</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stop)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        _stop = <span class="literal">true</span>;</span><br><span class="line">        _sFingers.Clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReTouch</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_stop)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        _stop = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过这种方式 实现无需额外的操作 使用上很方便</p>

        </article>
    </div>
</main>

    <footer>
    <div class="buttons">
        <button class="to-top" href="#"></button>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/09/06/guidefunction/">guidefunction</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/09/04/touch/">touch</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/09/02/48.16fixed/">48.16 fixed</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/08/30/sceneManager/">sceneManager</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/08/30/ugui/">ugui</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/08/22/curveMap/">curveMap</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/%E6%B8%B2%E6%9F%93/" style="font-size: 10px;">渲染</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2025 <a href="/">我勒博客</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":true,"night":true});</script>

  </body>
</html>
